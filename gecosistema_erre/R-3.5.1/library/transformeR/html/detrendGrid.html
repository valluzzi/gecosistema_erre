<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>R: Linear detrending</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="R.css" />
</head><body>

<table width="100%" summary="page for detrendGrid {transformeR}"><tr><td>detrendGrid {transformeR}</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2>Linear detrending</h2>

<h3>Description</h3>

<p>Perform a linear detrending along the time dimension of a grid
</p>


<h3>Usage</h3>

<pre>
detrendGrid(grid, grid2 = NULL, parallel = FALSE, max.ncores = 16,
  ncores = NULL)
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>grid</code></td>
<td>
<p>Input grid (possibly multimember)</p>
</td></tr>
<tr valign="top"><td><code>grid2</code></td>
<td>
<p>Optional grid. If provided, the output is the detrended <code>grid2</code>
using the regression coefficients calculated using <code>grid</code>. Default to <code>NULL</code>.</p>
</td></tr>
<tr valign="top"><td><code>parallel</code></td>
<td>
<p>Logical. Should parallel execution be used?</p>
</td></tr>
<tr valign="top"><td><code>max.ncores</code></td>
<td>
<p>Integer. Upper bound for user-defined number of cores.</p>
</td></tr>
<tr valign="top"><td><code>ncores</code></td>
<td>
<p>Integer number of cores used in parallel computation. Self-selected number of
cores is used when <code>ncpus = NULL</code> (the default), or when <code>maxcores</code> exceeds the default <code>ncores</code> value.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Performs a simple linear detrending by fitting a linear model and retaining the residuals.
An attribute indicating the linear detrending is added to the <code>Variable</code> component of the output grid.
</p>
<p>In the presence of missing data in the time series, it operates by filtering them prior to linear model fitting. The
missing data positions are then restored back to the output detrended series.
</p>
<p>The function uses the <code><a href="../../RcppEigen/html/fastLm.html">fastLm</a></code> implementation from package <span class="pkg">RcppEigen</span>, significantly speeding-up 
the linear model fitting.
</p>


<h3>Value</h3>

<p>A detrended grid.
</p>


<h3>Parallel Processing</h3>

<p>Parallel processing is enabled using the <span class="pkg">parallel</span> package. 
Parallelization is undertaken by a FORK-type parallel socket cluster formed by <code>ncores</code>.
If <code>ncores</code> is not specified (default), <code>ncores</code> will be one less than the autodetected number of cores.
The maximum number of cores used for parallel processing can be set with the <code>max.ncores</code> argument, 
although this will be reset to the auto-detected number of cores minus 1 if this number is exceeded. Note that not all 
code, but just some critical loops within the function are parallelized.
</p>
<p>In practice, parallelization does not always result in smaller execution times, due to the parallel overhead.
However, parallel computing may potentially provide a significant speedup for the 
particular case of large multimember datasets or large grids.
</p>
<p>Parallel computing is currently not available for Windows machines.
</p>


<h3>Author(s)</h3>

<p>J Bedia, J Fernandez, M.D. Frias
</p>


<h3>Examples</h3>

<pre>
data("NCEP_Iberia_ta850")
monthly &lt;- aggregateGrid(NCEP_Iberia_ta850, aggr.m = list(FUN = "mean"))
plot(monthly$Data[,4,2], ty = 'l')
abline(reg = lm(monthly$Data[,4,2] ~ I(1:length(monthly$Data[,4,2]))), lty = 2)
det &lt;- detrendGrid(monthly, parallel = FALSE)
# Detrended series in red
lines(det$Data[,4,2], col = "red")
abline(reg = lm(det$Data[,4,2] ~ I(1:length(det$Data[,4,2]))), col = "red", lty = 2)
legend("topright", c("Raw", "Detrended"), lty = 1, col = c(1,2))
## example of forecast detrend
# Suppose 1991-2001 is the reference period. We use it to detrend data from year 2002
grid &lt;- subsetGrid(monthly, years = 1991:2001)
grid2 &lt;- subsetGrid(monthly, years = 2002)
det2 &lt;- detrendGrid(grid, grid2, parallel = FALSE)
# det2 is the grid2 (year 2002) corrected according to the linear trend computed for 1991-2001
</pre>

<hr /><div style="text-align: center;">[Package <em>transformeR</em> version 1.4.2 <a href="00Index.html">Index</a>]</div>
</body></html>
